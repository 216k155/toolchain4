--- src/ld/parsers/macho_relocatable_file.cpp.orig	2011-07-27 01:10:35.000000000 +0100
+++ src/ld/parsers/macho_relocatable_file.cpp	2012-07-22 17:00:42.000000000 +0100
@@ -50,7 +50,11 @@
 #include "ld.hpp"
 #include "macho_relocatable_file.h"
 
-
+#ifdef __APPLE__
+ #define QSORT_R(_a,_b,_c,_vp,_fn) ::qsort_r((_a), (_b), (_c), (_vp), &(_fn))
+#else
+ #define QSORT_R(_a,_b,_c,_vp,_fn) ::qsort_r((_a), (_b), (_c), (int(*)(void*, const void*, const void*))(_fn), (_vp))
+#endif
 
 extern void throwf(const char* format, ...) __attribute__ ((noreturn,format(printf, 1, 2)));
 extern void warning(const char* format, ...) __attribute__((format(printf, 1, 2)));
@@ -1885,9 +1889,9 @@
 	// sort by symbol table address
 	for (uint32_t i=0; i < _machOSectionsCount; ++i)
 		array[i] = i;
-	::qsort_r(array, _machOSectionsCount, sizeof(uint32_t), this, &sectionIndexSorter);
+	QSORT_R(array, _machOSectionsCount, sizeof(uint32_t), this, sectionIndexSorter);
 
-	if ( log ) {
+    if ( log ) {
 		fprintf(stderr, "sorted sections:\n");
 		for(unsigned int i=0; i < _machOSectionsCount; ++i ) 
 			fprintf(stderr, "0x%08llX %s %s\n", _sectionsStart[array[i]].addr(), _sectionsStart[array[i]].segname(), _sectionsStart[array[i]].sectname());
@@ -1969,7 +1973,7 @@
 	
 	// sort by symbol table address
 	ParserAndSectionsArray extra = { this, sectionArray };
-	::qsort_r(array, _symbolsInSections, sizeof(uint32_t), &extra, &symbolIndexSorter);
+	QSORT_R(array, _symbolsInSections, sizeof(uint32_t), &extra, symbolIndexSorter);
 	
 	// look for two symbols at same address
 	_overlappingSymbols = false;
